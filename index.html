<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Modulation Learning Tool</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600&family=Orbitron:wght@400;500;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { background: #0a0a0f; }
    
    @keyframes glow {
      0%, 100% { filter: brightness(1); }
      50% { filter: brightness(1.3); }
    }
    
    @keyframes pulse-ring {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }
    
    .scheme-btn {
      background: linear-gradient(180deg, #1a1a24 0%, #0f0f16 100%);
      border: 1px solid #2a2a3a;
      color: #888;
      padding: 10px 16px;
      font-family: 'Orbitron', monospace;
      font-size: 10px;
      font-weight: 500;
      letter-spacing: 2px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .scheme-btn:hover {
      border-color: #444;
      color: #ccc;
      transform: translateY(-2px);
    }
    
    .scheme-btn.active {
      border-color: var(--scheme-color);
      color: var(--scheme-color);
      box-shadow: 0 0 20px var(--scheme-glow), inset 0 0 20px var(--scheme-glow);
    }

    .control-btn {
      background: linear-gradient(180deg, #1a1a24 0%, #0f0f16 100%);
      border: 1px solid #2a2a3a;
      color: #888;
      padding: 8px 16px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    
    .control-btn:hover:not(:disabled) {
      border-color: #00ff88;
      color: #00ff88;
    }
    
    .control-btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .control-btn.playing {
      border-color: #ff6b35;
      color: #ff6b35;
    }

    .bit-cell {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 28px;
      height: 28px;
      border: 1px solid #2a2a3a;
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.2s ease;
      user-select: none;
    }
    
    .bit-cell:hover {
      border-color: #444;
      background: #1a1a24;
    }
    
    .bit-cell.active {
      border-color: var(--scheme-color);
      background: var(--scheme-glow);
      color: var(--scheme-color);
      box-shadow: 0 0 10px var(--scheme-glow);
    }

    .constellation-point {
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .constellation-point:hover {
      filter: brightness(1.5);
    }

    .info-panel {
      background: linear-gradient(180deg, rgba(0,255,136,0.1) 0%, rgba(0,255,136,0.02) 100%);
      border: 1px solid rgba(0,255,136,0.3);
      border-radius: 4px;
      padding: 16px;
      margin-top: 16px;
    }

    .slider-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .slider {
      -webkit-appearance: none;
      appearance: none;
      height: 4px;
      background: #2a2a3a;
      border-radius: 2px;
      outline: none;
      flex: 1;
    }
    
    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 14px;
      height: 14px;
      background: var(--scheme-color, #00ff88);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px var(--scheme-color, #00ff88);
    }

    @media (max-width: 1100px) {
      .main-grid {
        grid-template-columns: 1fr !important;
      }
      .freq-grid {
        grid-template-columns: 1fr !important;
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback, useRef } = React;

    const ModulationVisualizer = () => {
      const [activeScheme, setActiveScheme] = useState('BPSK');
      const [bitSequence, setBitSequence] = useState([1, 0, 1, 1, 0, 0, 1, 0]);
      const [currentSymbolIndex, setCurrentSymbolIndex] = useState(0);
      const [isPlaying, setIsPlaying] = useState(false);
      const [playbackSpeed, setPlaybackSpeed] = useState(1);
      const [noiseLevel, setNoiseLevel] = useState(0);
      const [showEducationalInfo, setShowEducationalInfo] = useState(true);
      const [time, setTime] = useState(0);
      const [hoveredPoint, setHoveredPoint] = useState(null);
      
      const playIntervalRef = useRef(null);

      const schemes = {
        BPSK: {
          name: 'Binary Phase Shift Keying',
          shortDesc: '1 bit per symbol',
          description: 'BPSK encodes data by shifting the carrier phase by 180°. A "1" bit uses 0° phase, while a "0" bit uses 180° phase. It\'s the simplest and most robust digital modulation scheme.',
          bitsPerSymbol: 1,
          points: [
            { x: -1, y: 0, bits: '0', phase: '180°' },
            { x: 1, y: 0, bits: '1', phase: '0°' },
          ],
          color: '#00ff88',
          glow: '#00ff8844',
          education: {
            pros: ['Most noise resistant', 'Simple to implement', 'Good for low SNR channels'],
            cons: ['Low spectral efficiency (1 bps/Hz)', 'Lower data rate'],
            usage: ['Satellite communications', 'Deep space links', 'RFID systems']
          }
        },
        QPSK: {
          name: 'Quadrature Phase Shift Keying',
          shortDesc: '2 bits per symbol',
          description: 'QPSK uses four phase states (45°, 135°, 225°, 315°) to encode 2 bits per symbol. This doubles the data rate compared to BPSK with the same bandwidth.',
          bitsPerSymbol: 2,
          points: [
            { x: 0.707, y: 0.707, bits: '00', phase: '45°' },
            { x: -0.707, y: 0.707, bits: '01', phase: '135°' },
            { x: -0.707, y: -0.707, bits: '11', phase: '225°' },
            { x: 0.707, y: -0.707, bits: '10', phase: '315°' },
          ],
          color: '#ff6b35',
          glow: '#ff6b3544',
          education: {
            pros: ['2x data rate vs BPSK', 'Same bandwidth as BPSK', 'Good noise immunity'],
            cons: ['More complex demodulation', 'Phase ambiguity possible'],
            usage: ['Wi-Fi', 'LTE/4G', 'Cable modems', 'DVB-S']
          }
        },
        '16QAM': {
          name: '16 Quadrature Amplitude Modulation',
          shortDesc: '4 bits per symbol',
          description: '16-QAM combines both amplitude and phase modulation to create 16 distinct symbols, encoding 4 bits per symbol. Higher efficiency but more susceptible to noise.',
          bitsPerSymbol: 4,
          points: [
            { x: -3, y: 3, bits: '0000' }, { x: -1, y: 3, bits: '0001' }, { x: 1, y: 3, bits: '0011' }, { x: 3, y: 3, bits: '0010' },
            { x: -3, y: 1, bits: '0100' }, { x: -1, y: 1, bits: '0101' }, { x: 1, y: 1, bits: '0111' }, { x: 3, y: 1, bits: '0110' },
            { x: -3, y: -1, bits: '1100' }, { x: -1, y: -1, bits: '1101' }, { x: 1, y: -1, bits: '1111' }, { x: 3, y: -1, bits: '1110' },
            { x: -3, y: -3, bits: '1000' }, { x: -1, y: -3, bits: '1001' }, { x: 1, y: -3, bits: '1011' }, { x: 3, y: -3, bits: '1010' },
          ].map(p => ({ ...p, x: p.x / 3, y: p.y / 3 })),
          color: '#a855f7',
          glow: '#a855f744',
          education: {
            pros: ['4x data rate vs BPSK', 'High spectral efficiency (4 bps/Hz)'],
            cons: ['Requires higher SNR', 'More complex hardware', 'Sensitive to amplitude distortion'],
            usage: ['Wi-Fi (802.11)', 'Digital TV', 'DSL modems']
          }
        },
        FSK: {
          name: 'Frequency Shift Keying',
          shortDesc: '1 bit per symbol',
          description: 'FSK encodes data by shifting between two carrier frequencies. A "0" uses a lower frequency (f₁), while a "1" uses a higher frequency (f₂). Very robust against amplitude noise.',
          bitsPerSymbol: 1,
          points: [
            { x: -0.7, y: 0, bits: '0', freq: 'f₁ (low)' },
            { x: 0.7, y: 0, bits: '1', freq: 'f₂ (high)' },
          ],
          color: '#06b6d4',
          glow: '#06b6d444',
          isFSK: true,
          education: {
            pros: ['Immune to amplitude noise', 'Simple non-coherent detection', 'Robust in fading channels'],
            cons: ['Requires more bandwidth', 'Lower spectral efficiency'],
            usage: ['Bluetooth', 'Pagers', 'Caller ID', 'Early modems']
          }
        },
      };

      const scheme = schemes[activeScheme];
      const bitsPerSymbol = scheme.bitsPerSymbol;
      
      // Calculate symbols from bits
      const symbols = useMemo(() => {
        const syms = [];
        for (let i = 0; i < bitSequence.length; i += bitsPerSymbol) {
          const bits = bitSequence.slice(i, i + bitsPerSymbol);
          if (bits.length === bitsPerSymbol) {
            const bitString = bits.join('');
            const point = scheme.points.find(p => p.bits === bitString);
            syms.push({ bits: bitString, point, index: syms.length });
          }
        }
        return syms;
      }, [bitSequence, activeScheme, bitsPerSymbol]);

      const currentSymbol = symbols[currentSymbolIndex];

      // Animation timer
      useEffect(() => {
        const interval = setInterval(() => {
          setTime(t => t + 0.05);
        }, 50);
        return () => clearInterval(interval);
      }, []);

      // Playback control
      useEffect(() => {
        if (isPlaying && symbols.length > 0) {
          playIntervalRef.current = setInterval(() => {
            setCurrentSymbolIndex(prev => {
              if (prev >= symbols.length - 1) {
                setIsPlaying(false);
                return 0;
              }
              return prev + 1;
            });
          }, 1000 / playbackSpeed);
        }
        return () => {
          if (playIntervalRef.current) {
            clearInterval(playIntervalRef.current);
          }
        };
      }, [isPlaying, symbols.length, playbackSpeed]);

      // Reset symbol index when scheme changes
      useEffect(() => {
        setCurrentSymbolIndex(0);
        setIsPlaying(false);
      }, [activeScheme]);

      // Toggle bit
      const toggleBit = (index) => {
        const newBits = [...bitSequence];
        newBits[index] = newBits[index] === 0 ? 1 : 0;
        setBitSequence(newBits);
      };

      // Add bit
      const addBit = (value) => {
        if (bitSequence.length < 32) {
          setBitSequence([...bitSequence, value]);
        }
      };

      // Remove last bit
      const removeBit = () => {
        if (bitSequence.length > bitsPerSymbol) {
          setBitSequence(bitSequence.slice(0, -1));
        }
      };

      // Clear sequence
      const clearSequence = () => {
        setBitSequence(Array(bitsPerSymbol).fill(0));
        setCurrentSymbolIndex(0);
      };

      // Click constellation point to add symbol
      const addSymbolFromPoint = (point) => {
        const newBits = point.bits.split('').map(Number);
        if (bitSequence.length + newBits.length <= 32) {
          setBitSequence([...bitSequence, ...newBits]);
        }
      };

      // Generate noisy point
      const getNoisyPoint = (point) => {
        if (!point || noiseLevel === 0) return point;
        const noise = noiseLevel * 0.3;
        return {
          ...point,
          x: point.x + (Math.random() - 0.5) * noise,
          y: point.y + (Math.random() - 0.5) * noise,
        };
      };

      // Generate signal data
      const signalData = useMemo(() => {
        const points = [];
        const samplesPerSymbol = 50;
        
        symbols.forEach((sym, symIdx) => {
          for (let i = 0; i < samplesPerSymbol; i++) {
            const t = i / samplesPerSymbol;
            const globalX = (symIdx + t) / symbols.length;
            
            let y = 0;
            if (scheme.isFSK) {
              const freq = sym.bits === '1' ? 12 : 6;
              y = Math.sin(t * Math.PI * 2 * freq);
            } else {
              const point = sym.point;
              if (point) {
                const phase = Math.atan2(point.y, point.x);
                const amp = Math.sqrt(point.x * point.x + point.y * point.y);
                y = amp * Math.sin(t * Math.PI * 2 * 4 + phase);
              }
            }
            
            // Add noise
            if (noiseLevel > 0) {
              y += (Math.random() - 0.5) * noiseLevel * 0.5;
            }
            
            points.push({ x: globalX, y, symbolIndex: symIdx });
          }
        });
        
        return points;
      }, [symbols, activeScheme, noiseLevel]);

      // Frequency domain data
      const frequencyData = useMemo(() => {
        const points = [];
        const numPoints = 200;
        
        for (let i = 0; i < numPoints; i++) {
          const f = (i - numPoints / 2) / (numPoints / 8);
          let magnitude = 0;
          
          if (activeScheme === 'FSK') {
            const f1 = -0.8, f2 = 0.8;
            const sinc1 = Math.abs(f - f1) < 0.01 ? 1 : Math.sin(Math.PI * (f - f1) * 2) / (Math.PI * (f - f1) * 2);
            const sinc2 = Math.abs(f - f2) < 0.01 ? 1 : Math.sin(Math.PI * (f - f2) * 2) / (Math.PI * (f - f2) * 2);
            magnitude = 0.5 * (sinc1 * sinc1 + sinc2 * sinc2);
          } else {
            const bw = activeScheme === 'BPSK' ? 1.5 : 2;
            const sincVal = Math.abs(f) < 0.01 ? 1 : Math.sin(Math.PI * f * bw) / (Math.PI * f * bw);
            magnitude = sincVal * sincVal;
          }
          
          points.push({ f, magnitude: Math.max(0, magnitude) });
        }
        return points;
      }, [activeScheme]);

      const gridScale = activeScheme === '16QAM' ? 1.2 : 1.5;

      return (
        <div style={{
          minHeight: '100vh',
          background: 'linear-gradient(135deg, #0a0a0f 0%, #12121a 50%, #0d0d14 100%)',
          fontFamily: '"Inter", sans-serif',
          color: '#e0e0e0',
          padding: '20px',
          boxSizing: 'border-box',
        }}>
          {/* Header */}
          <header style={{ textAlign: 'center', marginBottom: '24px' }}>
            <h1 style={{
              fontFamily: '"Orbitron", sans-serif',
              fontSize: '24px',
              fontWeight: 700,
              letterSpacing: '6px',
              background: `linear-gradient(90deg, ${scheme.color}, #fff, ${scheme.color})`,
              WebkitBackgroundClip: 'text',
              WebkitTextFillColor: 'transparent',
              marginBottom: '6px',
              textTransform: 'uppercase',
            }}>
              Digital Modulation Lab
            </h1>
            <p style={{ fontSize: '12px', letterSpacing: '3px', color: '#666', textTransform: 'uppercase' }}>
              Interactive Learning Tool • Click, Explore, Learn
            </p>
          </header>

          {/* Scheme Selector */}
          <div style={{ display: 'flex', justifyContent: 'center', gap: '10px', marginBottom: '24px', flexWrap: 'wrap' }}>
            {Object.keys(schemes).map(key => (
              <button
                key={key}
                className={`scheme-btn ${activeScheme === key ? 'active' : ''}`}
                style={{ '--scheme-color': schemes[key].color, '--scheme-glow': schemes[key].glow }}
                onClick={() => setActiveScheme(key)}
              >
                {key}
              </button>
            ))}
          </div>

          {/* Main Content */}
          <div className="main-grid" style={{
            display: 'grid',
            gridTemplateColumns: '1fr 1.2fr',
            gap: '20px',
            maxWidth: '1400px',
            margin: '0 auto',
          }}>
            {/* Left Column - Constellation */}
            <div>
              {/* Constellation Diagram */}
              <div style={{
                background: 'linear-gradient(180deg, #0d0d14 0%, #080810 100%)',
                border: '1px solid #1a1a2a',
                borderRadius: '4px',
                padding: '20px',
                position: 'relative',
              }}>
                <div style={{
                  display: 'flex',
                  justifyContent: 'space-between',
                  alignItems: 'center',
                  marginBottom: '12px',
                }}>
                  <div style={{ fontSize: '10px', letterSpacing: '2px', color: '#444', textTransform: 'uppercase' }}>
                    Constellation Diagram
                  </div>
                  <div style={{ fontSize: '10px', color: '#666' }}>
                    Click a point to add symbol →
                  </div>
                </div>
                
                <svg viewBox="-1.5 -1.5 3 3" style={{ width: '100%', aspectRatio: '1', display: 'block' }}>
                  {/* Grid */}
                  {[-1, -0.5, 0, 0.5, 1].map(v => (
                    <React.Fragment key={v}>
                      <line x1={-gridScale} y1={v} x2={gridScale} y2={v} stroke="#1e1e2e" strokeWidth="0.5" />
                      <line x1={v} y1={-gridScale} x2={v} y2={gridScale} stroke="#1e1e2e" strokeWidth="0.5" />
                    </React.Fragment>
                  ))}
                  
                  {/* Axes */}
                  <line x1={-gridScale} y1="0" x2={gridScale} y2="0" stroke="#3a3a4a" strokeWidth="1" />
                  <line x1="0" y1={-gridScale} x2="0" y2={gridScale} stroke="#3a3a4a" strokeWidth="1" />
                  <text x="1.3" y="0.08" fill="#555" fontSize="0.12" fontFamily="Orbitron">I</text>
                  <text x="0.04" y="-1.25" fill="#555" fontSize="0.12" fontFamily="Orbitron">Q</text>
                  
                  {/* Unit circle for PSK */}
                  {(activeScheme === 'BPSK' || activeScheme === 'QPSK') && (
                    <circle cx="0" cy="0" r="0.707" fill="none" stroke={scheme.color} strokeWidth="0.01" opacity="0.3" strokeDasharray="0.04 0.02" />
                  )}
                  
                  {/* Constellation Points */}
                  {scheme.points.map((point, i) => {
                    const isCurrentSymbol = currentSymbol?.point?.bits === point.bits;
                    const isHovered = hoveredPoint === i;
                    
                    return (
                      <g 
                        key={i} 
                        className="constellation-point"
                        onClick={() => addSymbolFromPoint(point)}
                        onMouseEnter={() => setHoveredPoint(i)}
                        onMouseLeave={() => setHoveredPoint(null)}
                        style={{ cursor: 'pointer' }}
                      >
                        {/* Pulse ring for current symbol */}
                        {isCurrentSymbol && (
                          <circle
                            cx={point.x}
                            cy={-point.y}
                            r="0.15"
                            fill="none"
                            stroke={scheme.color}
                            strokeWidth="0.02"
                            opacity="0.6"
                          >
                            <animate attributeName="r" from="0.08" to="0.25" dur="1s" repeatCount="indefinite" />
                            <animate attributeName="opacity" from="0.8" to="0" dur="1s" repeatCount="indefinite" />
                          </circle>
                        )}
                        
                        {/* Glow */}
                        <circle
                          cx={point.x}
                          cy={-point.y}
                          r={isCurrentSymbol ? 0.15 : isHovered ? 0.12 : 0.1}
                          fill={scheme.glow}
                        />
                        
                        {/* Point */}
                        <circle
                          cx={point.x}
                          cy={-point.y}
                          r={isCurrentSymbol ? 0.08 : isHovered ? 0.07 : 0.05}
                          fill={isCurrentSymbol ? '#fff' : scheme.color}
                          stroke={scheme.color}
                          strokeWidth="0.015"
                        />
                        
                        {/* Label */}
                        <text
                          x={point.x}
                          y={-point.y + 0.2}
                          fill={isCurrentSymbol ? '#fff' : scheme.color}
                          fontSize="0.09"
                          textAnchor="middle"
                          fontFamily="JetBrains Mono"
                          fontWeight={isCurrentSymbol ? '600' : '400'}
                        >
                          {point.bits}
                        </text>
                      </g>
                    );
                  })}
                  
                  {/* Noisy received point */}
                  {noiseLevel > 0 && currentSymbol?.point && (
                    <g>
                      {[...Array(5)].map((_, i) => {
                        const noisy = getNoisyPoint(currentSymbol.point);
                        return (
                          <circle
                            key={i}
                            cx={noisy.x}
                            cy={-noisy.y}
                            r="0.03"
                            fill={scheme.color}
                            opacity="0.4"
                          />
                        );
                      })}
                    </g>
                  )}
                </svg>

                {/* Hover info */}
                {hoveredPoint !== null && (
                  <div style={{
                    position: 'absolute',
                    bottom: '12px',
                    left: '50%',
                    transform: 'translateX(-50%)',
                    background: '#0a0a10',
                    border: `1px solid ${scheme.color}44`,
                    padding: '8px 16px',
                    borderRadius: '4px',
                    fontSize: '11px',
                    color: scheme.color,
                    fontFamily: 'JetBrains Mono',
                  }}>
                    Bits: {scheme.points[hoveredPoint].bits} | 
                    {scheme.points[hoveredPoint].phase ? ` Phase: ${scheme.points[hoveredPoint].phase}` : ''}
                    {scheme.points[hoveredPoint].freq ? ` Freq: ${scheme.points[hoveredPoint].freq}` : ''}
                    {' '}| I: {scheme.points[hoveredPoint].x.toFixed(2)}, Q: {scheme.points[hoveredPoint].y.toFixed(2)}
                  </div>
                )}
              </div>

              {/* Educational Info */}
              {showEducationalInfo && (
                <div style={{
                  background: `linear-gradient(180deg, ${scheme.glow} 0%, transparent 100%)`,
                  border: `1px solid ${scheme.color}33`,
                  borderRadius: '4px',
                  padding: '16px',
                  marginTop: '16px',
                }}>
                  <h3 style={{ fontSize: '14px', color: scheme.color, marginBottom: '8px', fontFamily: 'Orbitron' }}>
                    {scheme.name}
                  </h3>
                  <p style={{ fontSize: '12px', color: '#aaa', marginBottom: '12px', lineHeight: '1.5' }}>
                    {scheme.description}
                  </p>
                  
                  <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '12px', fontSize: '10px' }}>
                    <div>
                      <div style={{ color: '#00ff88', marginBottom: '4px', fontWeight: '600' }}>✓ Advantages</div>
                      {scheme.education.pros.map((pro, i) => (
                        <div key={i} style={{ color: '#888', marginBottom: '2px' }}>• {pro}</div>
                      ))}
                    </div>
                    <div>
                      <div style={{ color: '#ff6b35', marginBottom: '4px', fontWeight: '600' }}>✗ Disadvantages</div>
                      {scheme.education.cons.map((con, i) => (
                        <div key={i} style={{ color: '#888', marginBottom: '2px' }}>• {con}</div>
                      ))}
                    </div>
                    <div>
                      <div style={{ color: '#06b6d4', marginBottom: '4px', fontWeight: '600' }}>◎ Common Uses</div>
                      {scheme.education.usage.map((use, i) => (
                        <div key={i} style={{ color: '#888', marginBottom: '2px' }}>• {use}</div>
                      ))}
                    </div>
                  </div>
                </div>
              )}
            </div>

            {/* Right Column - Controls & Signals */}
            <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
              {/* Bit Sequence Editor */}
              <div style={{
                background: 'linear-gradient(180deg, #0d0d14 0%, #080810 100%)',
                border: '1px solid #1a1a2a',
                borderRadius: '4px',
                padding: '16px',
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                  <div style={{ fontSize: '10px', letterSpacing: '2px', color: '#444', textTransform: 'uppercase' }}>
                    Bit Sequence Editor
                  </div>
                  <div style={{ fontSize: '10px', color: '#666' }}>
                    {bitSequence.length} bits → {symbols.length} symbols
                  </div>
                </div>
                
                {/* Bit cells */}
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '4px', marginBottom: '12px' }}>
                  {bitSequence.map((bit, i) => {
                    const symbolIdx = Math.floor(i / bitsPerSymbol);
                    const isInCurrentSymbol = symbolIdx === currentSymbolIndex;
                    
                    return (
                      <div
                        key={i}
                        className={`bit-cell ${isInCurrentSymbol ? 'active' : ''}`}
                        style={{
                          '--scheme-color': scheme.color,
                          '--scheme-glow': scheme.glow,
                          color: bit === 1 ? scheme.color : '#666',
                          borderLeft: i % bitsPerSymbol === 0 && i > 0 ? `2px solid ${scheme.color}44` : undefined,
                        }}
                        onClick={() => toggleBit(i)}
                      >
                        {bit}
                      </div>
                    );
                  })}
                </div>
                
                {/* Sequence controls */}
                <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                  <button className="control-btn" onClick={() => addBit(0)}>Add 0</button>
                  <button className="control-btn" onClick={() => addBit(1)}>Add 1</button>
                  <button className="control-btn" onClick={removeBit}>Remove</button>
                  <button className="control-btn" onClick={clearSequence}>Clear</button>
                  <button 
                    className="control-btn" 
                    onClick={() => setBitSequence(Array(16).fill(0).map(() => Math.round(Math.random())))}
                  >
                    Random
                  </button>
                </div>
              </div>

              {/* Playback Controls */}
              <div style={{
                background: 'linear-gradient(180deg, #0d0d14 0%, #080810 100%)',
                border: '1px solid #1a1a2a',
                borderRadius: '4px',
                padding: '16px',
              }}>
                <div style={{ fontSize: '10px', letterSpacing: '2px', color: '#444', textTransform: 'uppercase', marginBottom: '12px' }}>
                  Playback Controls
                </div>
                
                <div style={{ display: 'flex', gap: '8px', alignItems: 'center', flexWrap: 'wrap' }}>
                  <button 
                    className="control-btn" 
                    onClick={() => setCurrentSymbolIndex(Math.max(0, currentSymbolIndex - 1))}
                    disabled={currentSymbolIndex === 0}
                  >
                    ◀ Prev
                  </button>
                  
                  <button 
                    className={`control-btn ${isPlaying ? 'playing' : ''}`}
                    onClick={() => setIsPlaying(!isPlaying)}
                    disabled={symbols.length === 0}
                  >
                    {isPlaying ? '⏸ Pause' : '▶ Play'}
                  </button>
                  
                  <button 
                    className="control-btn"
                    onClick={() => setCurrentSymbolIndex(Math.min(symbols.length - 1, currentSymbolIndex + 1))}
                    disabled={currentSymbolIndex >= symbols.length - 1}
                  >
                    Next ▶
                  </button>
                  
                  <button 
                    className="control-btn"
                    onClick={() => { setCurrentSymbolIndex(0); setIsPlaying(false); }}
                  >
                    ⏮ Reset
                  </button>
                  
                  <div style={{ marginLeft: 'auto', display: 'flex', alignItems: 'center', gap: '8px' }}>
                    <span style={{ fontSize: '10px', color: '#666' }}>Speed:</span>
                    <select 
                      value={playbackSpeed}
                      onChange={(e) => setPlaybackSpeed(Number(e.target.value))}
                      style={{
                        background: '#0a0a10',
                        border: '1px solid #2a2a3a',
                        color: '#888',
                        padding: '4px 8px',
                        fontFamily: 'JetBrains Mono',
                        fontSize: '11px',
                      }}
                    >
                      <option value={0.5}>0.5x</option>
                      <option value={1}>1x</option>
                      <option value={2}>2x</option>
                      <option value={4}>4x</option>
                    </select>
                  </div>
                </div>
                
                {/* Current symbol info */}
                {currentSymbol && (
                  <div style={{
                    marginTop: '12px',
                    padding: '10px',
                    background: scheme.glow,
                    borderRadius: '4px',
                    display: 'flex',
                    justifyContent: 'space-between',
                    alignItems: 'center',
                  }}>
                    <div>
                      <span style={{ fontSize: '10px', color: '#888' }}>Symbol {currentSymbolIndex + 1}/{symbols.length}: </span>
                      <span style={{ fontSize: '16px', color: scheme.color, fontFamily: 'JetBrains Mono', fontWeight: '600' }}>
                        {currentSymbol.bits}
                      </span>
                    </div>
                    <div style={{ fontSize: '11px', color: '#888' }}>
                      I = {currentSymbol.point?.x.toFixed(3)}, Q = {currentSymbol.point?.y.toFixed(3)}
                    </div>
                  </div>
                )}
              </div>

              {/* Time Domain */}
              <div style={{
                background: 'linear-gradient(180deg, #0d0d14 0%, #080810 100%)',
                border: '1px solid #1a1a2a',
                borderRadius: '4px',
                padding: '16px',
              }}>
                <div style={{ fontSize: '10px', letterSpacing: '2px', color: '#444', textTransform: 'uppercase', marginBottom: '12px' }}>
                  Time Domain Signal
                </div>
                
                <svg viewBox="0 0 200 50" style={{ width: '100%', height: '80px', display: 'block' }}>
                  {/* Grid */}
                  {[0, 12.5, 25, 37.5, 50].map(y => (
                    <line key={y} x1="0" y1={y} x2="200" y2={y} stroke="#1a1a2a" strokeWidth="0.5" />
                  ))}
                  
                  {/* Symbol boundaries */}
                  {symbols.map((_, i) => (
                    <line 
                      key={i} 
                      x1={(i / symbols.length) * 200} 
                      y1="0" 
                      x2={(i / symbols.length) * 200} 
                      y2="50" 
                      stroke={i === currentSymbolIndex ? scheme.color : '#2a2a3a'} 
                      strokeWidth={i === currentSymbolIndex ? 1 : 0.5}
                      strokeDasharray={i === currentSymbolIndex ? 'none' : '2 2'}
                    />
                  ))}
                  
                  {/* Current symbol highlight */}
                  {symbols.length > 0 && (
                    <rect
                      x={(currentSymbolIndex / symbols.length) * 200}
                      y="0"
                      width={200 / symbols.length}
                      height="50"
                      fill={scheme.glow}
                      opacity="0.3"
                    />
                  )}
                  
                  {/* Center line */}
                  <line x1="0" y1="25" x2="200" y2="25" stroke="#3a3a4a" strokeWidth="0.5" />
                  
                  {/* Signal */}
                  <path
                    d={signalData.map((p, i) => 
                      `${i === 0 ? 'M' : 'L'} ${p.x * 200} ${25 - p.y * 20}`
                    ).join(' ')}
                    fill="none"
                    stroke={scheme.color}
                    strokeWidth="1.5"
                  />
                </svg>
              </div>

              {/* Frequency Domain */}
              <div style={{
                background: 'linear-gradient(180deg, #0d0d14 0%, #080810 100%)',
                border: '1px solid #1a1a2a',
                borderRadius: '4px',
                padding: '16px',
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                  <div style={{ fontSize: '10px', letterSpacing: '2px', color: '#444', textTransform: 'uppercase' }}>
                    Power Spectral Density
                  </div>
                  <div style={{ fontSize: '9px', color: '#555' }}>Frequency →</div>
                </div>
                
                <svg viewBox="0 0 200 50" style={{ width: '100%', height: '70px', display: 'block' }}>
                  <defs>
                    <linearGradient id="psdGrad" x1="0" y1="0" x2="0" y2="1">
                      <stop offset="0%" stopColor={scheme.color} stopOpacity="0.6" />
                      <stop offset="100%" stopColor={scheme.color} stopOpacity="0.05" />
                    </linearGradient>
                  </defs>
                  
                  {/* Grid */}
                  {[0, 25, 50].map(y => (
                    <line key={y} x1="0" y1={y} x2="200" y2={y} stroke="#1a1a2a" strokeWidth="0.5" />
                  ))}
                  <line x1="100" y1="0" x2="100" y2="50" stroke="#2a2a3a" strokeWidth="0.5" />
                  
                  {/* PSD fill */}
                  <path
                    d={`M 0 50 ${frequencyData.map((p, i) => {
                      const x = (i / frequencyData.length) * 200;
                      const y = 50 - p.magnitude * 48;
                      return `L ${x} ${y}`;
                    }).join(' ')} L 200 50 Z`}
                    fill="url(#psdGrad)"
                  />
                  
                  {/* PSD line */}
                  <path
                    d={frequencyData.map((p, i) => {
                      const x = (i / frequencyData.length) * 200;
                      const y = 50 - p.magnitude * 48;
                      return `${i === 0 ? 'M' : 'L'} ${x} ${y}`;
                    }).join(' ')}
                    fill="none"
                    stroke={scheme.color}
                    strokeWidth="1.5"
                  />
                  
                  {/* FSK frequency markers */}
                  {activeScheme === 'FSK' && (
                    <>
                      <text x="70" y="48" fill={scheme.color} fontSize="6" textAnchor="middle">f₁</text>
                      <text x="130" y="48" fill={scheme.color} fontSize="6" textAnchor="middle">f₂</text>
                    </>
                  )}
                </svg>
              </div>

              {/* Noise Control */}
              <div style={{
                background: 'linear-gradient(180deg, #0d0d14 0%, #080810 100%)',
                border: '1px solid #1a1a2a',
                borderRadius: '4px',
                padding: '16px',
              }}>
                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
                  <div style={{ fontSize: '10px', letterSpacing: '2px', color: '#444', textTransform: 'uppercase' }}>
                    Channel Noise (AWGN)
                  </div>
                  <div style={{ fontSize: '11px', color: scheme.color, fontFamily: 'JetBrains Mono' }}>
                    {(noiseLevel * 100).toFixed(0)}%
                  </div>
                </div>
                
                <div className="slider-container" style={{ '--scheme-color': scheme.color }}>
                  <span style={{ fontSize: '10px', color: '#666' }}>Clean</span>
                  <input
                    type="range"
                    className="slider"
                    min="0"
                    max="1"
                    step="0.05"
                    value={noiseLevel}
                    onChange={(e) => setNoiseLevel(parseFloat(e.target.value))}
                    style={{ '--scheme-color': scheme.color }}
                  />
                  <span style={{ fontSize: '10px', color: '#666' }}>Noisy</span>
                </div>
                
                <p style={{ fontSize: '10px', color: '#555', marginTop: '8px' }}>
                  Increase noise to see how it affects the constellation and signal. Higher-order modulations (16-QAM) are more susceptible to noise errors.
                </p>
              </div>
            </div>
          </div>

          {/* Symbol Mapping Reference */}
          <div style={{
            maxWidth: '1400px',
            margin: '20px auto 0',
            background: 'linear-gradient(180deg, #0d0d14 0%, #080810 100%)',
            border: '1px solid #1a1a2a',
            borderRadius: '4px',
            padding: '16px',
          }}>
            <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '12px' }}>
              <div style={{ fontSize: '10px', letterSpacing: '2px', color: '#444', textTransform: 'uppercase' }}>
                Symbol Reference (click to add)
              </div>
              <button
                className="control-btn"
                onClick={() => setShowEducationalInfo(!showEducationalInfo)}
                style={{ padding: '4px 10px', fontSize: '10px' }}
              >
                {showEducationalInfo ? 'Hide' : 'Show'} Info
              </button>
            </div>
            
            <div style={{
              display: 'grid',
              gridTemplateColumns: `repeat(${Math.min(scheme.points.length, 8)}, 1fr)`,
              gap: '6px',
            }}>
              {scheme.points.map((point, i) => {
                const isCurrentSymbol = currentSymbol?.point?.bits === point.bits;
                
                return (
                  <div
                    key={i}
                    onClick={() => addSymbolFromPoint(point)}
                    style={{
                      background: isCurrentSymbol ? scheme.glow : '#0a0a10',
                      border: `1px solid ${isCurrentSymbol ? scheme.color : '#1a1a2a'}`,
                      borderRadius: '2px',
                      padding: '10px 6px',
                      textAlign: 'center',
                      cursor: 'pointer',
                      transition: 'all 0.2s ease',
                    }}
                  >
                    <div style={{
                      fontSize: '13px',
                      color: isCurrentSymbol ? '#fff' : scheme.color,
                      fontWeight: 600,
                      fontFamily: 'JetBrains Mono',
                    }}>
                      {point.bits}
                    </div>
                    <div style={{ fontSize: '8px', color: '#555', marginTop: '2px' }}>
                      ({point.x.toFixed(2)}, {point.y.toFixed(2)})
                    </div>
                  </div>
                );
              })}
            </div>
          </div>

          {/* Footer */}
          <footer style={{ textAlign: 'center', marginTop: '24px', fontSize: '10px', color: '#333', letterSpacing: '2px' }}>
            DIGITAL MODULATION LEARNING LAB • {activeScheme} • {symbols.length} SYMBOLS
          </footer>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<ModulationVisualizer />);
  </script>
</body>
</html>
